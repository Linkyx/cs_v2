"use strict";define(["ui","../apis/app","bootstrapValidator","jquery.serializeObject"],function(require,exports,module){require("bootstrapValidator"),require("jquery.serializeObject");var UI=require("ui"),App=require("../apis/app");$("#app_form").formValidation({autoFocus:!0,framework:"bootstrap",icon:{valid:!1,invalid:!1,validating:"fa fa-refresh"},row:{valid:"has-success"},fields:{client_id:{validators:{notEmpty:{message:"CLIENT_ID不能为空"}}},name:{validators:{notEmpty:{message:"应用名称不能为空"}}},homepage:{validators:{notEmpty:{message:"应用主页链接不能为空"},uri:{message:"应用主页链接必须为合法的URL"}}},logo:{validators:{notEmpty:{message:"应用Logo图片链接不能为空"},uri:{message:"应用Logo图片链接必须为合法的URL"}}},redirect_uri:{validators:{notEmpty:{message:"应用Oauth授权回调地址不能为空"},uri:{message:"应用Oauth授权回调地址必须为合法的URL"}}}}}).on("success.form.fv",function(e){e.preventDefault();var $form=$(e.target),data=($form.data("formValidation"),$("#app_form").serializeObject());console.log(data);var appId=$("#data_app_id").val();appId?App.update(appId,data).then(function(res){res&&res.id?UI.alert({message:"应用保存成功~"}).then(function(){window.location.href="/apps/"+res.id}):UI.alert("应用保存失败，请稍后再试~")}).catch(function(err){err&&err.message?UI.alert(err.message):UI.alert("应用保存失败，请稍后再试~")}):App.create(data).then(function(res){res&&res.id?UI.alert({message:"应用创建成功~"}).then(function(){window.location.href="/apps/"+res.id}):UI.alert("应用创建失败，请稍后再试~")}).catch(function(err){err&&err.message?UI.alert(err.message):UI.alert("应用创建失败，请稍后再试~")})})});